% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prepare_data.R
\name{prepare_data}
\alias{prepare_data}
\title{Prepare Expression Matrix for Crosstalk Analysis}
\usage{
prepare_data(
  expr = NULL,
  group_names = NULL,
  genes = NULL,
  z_norm = TRUE,
  missing_thr = 0.6,
  convert.ID = NULL,
  species = "human"
)
}
\arguments{
\item{expr}{A numeric matrix or data.frame with \strong{genes in rows} and
\strong{samples in columns}. Gene identifiers must be stored in \code{rownames(expr)}.}

\item{group_names}{Optional character vector of group-identifying patterns.
Each pattern is matched against \code{colnames(expr)} using \code{grepl()} to assign
samples to groups (e.g., \code{c("Tumor","Control")}). Required for group-aware
missing value handling.}

\item{genes}{Character vector of gene identifiers to retain. Only rows whose
row names intersect with \code{genes} are kept. Order follows the intersection.}

\item{z_norm}{Logical; if \code{TRUE} (default), performs per-gene z-score
normalization across samples (row-wise scaling).}

\item{missing_thr}{Numeric threshold in \verb{[0,1]} controlling filtering of
genes based on missingness (default = 0.6). A gene is removed if:
\itemize{
\item The difference between maximum and minimum group-wise NA proportions
is greater than or equal to \code{missing_thr}, or
\item The overall NA proportion across all samples is greater than or equal
to \code{missing_thr}.
}}

\item{convert.ID}{Optional flag. If not \code{NULL}, gene identifiers are converted
using \code{map_me(rownames(expr), species)}. The value of \code{convert.ID} itself is
not passed to \code{map_me()}; it serves only as a trigger.}

\item{species}{Character string passed to \code{map_me()} for identifier mapping. species supported are "human" and "mmusculus"
Default is \code{"human"}.}
}
\value{
A numeric matrix with genes in rows and samples in columns,
optionally ID-mapped, missingness-filtered, imputed, and/or z-score normalized.
}
\description{
Subsets and preprocesses a gene expression matrix for downstream crosstalk analysis.
The function optionally performs group-aware missingness filtering and imputation,
gene identifier conversion, and per-gene z-score normalization.
}
\details{
The function performs the following steps:
\enumerate{
\item Coerces \code{expr} to a numeric matrix.
\item Subsets rows to genes present in both \code{expr} and \code{genes}.
\item If missing values are present:
\itemize{
\item If \code{group_names} is \code{NULL}, a message is displayed and no imputation
is performed.
\item If \code{group_names} is provided:
\enumerate{
\item Samples are assigned to groups by pattern matching.
\item The function stops if any column fails to match a group.
\item Genes with excessive or imbalanced missingness (based on
\code{missing_thr}) are removed.
\item Remaining missing values are imputed within each group using
the row-wise median across that group's samples. If all values
in a group are missing for a gene, the imputed value defaults
to 0.
}
}
\item If \code{convert.ID} is not \code{NULL}, row names are mapped using \code{map_me()}.
Unmapped or empty identifiers are removed. If duplicate identifiers
arise, the gene with the highest mean expression is retained.
\item If \code{z_norm = TRUE}, per-gene z-scores are computed across samples.
Genes with zero variance yield \code{NA}, which are replaced with 0.
Values are rounded to two decimals.
}
}
\examples{
\dontrun{
set.seed(123)

expr <- data.frame(
  Tumor_1   = rnorm(5),
  Tumor_2   = rnorm(5),
  Control_1 = rnorm(5),
  Control_2 = rnorm(5)
)
rownames(expr) <- paste0("Gene", 1:5)
expr[2, 2] <- NA

result <- prepare_data(
  expr = expr,
  group_names = c("Tumor", "Control"),
  genes = rownames(expr),
  z_norm = TRUE,
  missing_thr = 0.6
)

head(result)
}
}
\seealso{
\code{\link{map_me}}
}
