% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prioritize_de.R
\name{prioritize_de}
\alias{prioritize_de}
\title{Prioritize Genes by Permutation-Based DE-Neighborhood Enrichment}
\usage{
prioritize_de(
  genes_oi,
  de_genes,
  net = NULL,
  B = 100,
  p_adj_method = "BH",
  alpha = 0.05,
  export = TRUE
)
}
\arguments{
\item{genes_oi}{Character vector of genes of interest to prioritize.}

\item{de_genes}{Character vector of DE genes. Identifiers must match network vertex names.}

\item{net}{Optional interaction edge-list \code{data.frame}. If \code{NULL}, loads the dataset \code{net}
bundled with \pkg{CrosstalkX} via \code{data("net", package = "CrosstalkX")}. The first two
columns are treated as endpoints and renamed to \code{source} and \code{target}.}

\item{B}{Integer. Number of permutations used to construct the empirical null distribution.
Default is \code{100}.}

\item{p_adj_method}{Character string specifying the multiple-testing adjustment method
passed to \code{\link[stats:p.adjust]{stats::p.adjust()}}. Default is \code{"BH"}.}

\item{alpha}{Numeric in (0, 1). Significance cutoff applied to adjusted p-values (FDR).
Default is \code{0.05}.}

\item{export}{Logical. If \code{TRUE} (default), writes CSV files for all genes and significant
genes only (see Details).}
}
\value{
A \code{data.frame} of significant genes with columns:
\describe{
\item{gene}{Gene identifier.}
\item{obs_de_neighbors}{Observed number of DE neighbors.}
\item{null_mean}{Mean DE-neighbor count under permutation.}
\item{null_sd}{Standard deviation of permuted counts.}
\item{z_empirical}{Empirical z-score based on permutation mean/sd.}
\item{pval}{One-sided empirical p-value.}
\item{padj}{Adjusted p-value (FDR) using \code{p_adj_method}.}
}
If no genes pass the threshold, an empty \code{data.frame} with the same columns is returned.
}
\description{
Test whether each gene of interest has more differentially expressed (DE) neighbors than
expected by chance in a background interaction network, using an empirical null
distribution generated by permutation. For each gene, the observed number of DE
neighbors (1-hop) is compared to counts obtained from randomly relabeling DE genes.
}
\details{
The procedure:
\enumerate{
\item Load the network (if \code{net} is \code{NULL}), keep edges whose endpoints are in
\code{unique(c(genes_oi, de_genes))}, remove missing/empty endpoints, and build an undirected
graph with \code{\link[igraph:graph_from_data_frame]{igraph::graph_from_data_frame()}}.
\item Restrict \code{genes_oi} and \code{de_genes} to vertices present in the graph.
\item For each gene in \code{genes_oi}, compute the observed number of DE neighbors using the
1-hop neighborhood from \code{\link[igraph:ego]{igraph::ego()}} (self excluded).
\item Repeat \code{B} times: sample \code{length(de_genes)} random vertices without replacement,
treat them as the DE set, and recompute DE-neighbor counts for all genes of interest.
\item Compute a one-sided empirical p-value per gene:
\deqn{p = \frac{1 + \sum_{b=1}^{B} I(X_b \ge X_{obs})}{B+1}}
where \eqn{X_{obs}} is the observed DE-neighbor count and \eqn{X_b} is the permuted count.
\item Adjust p-values using \code{p_adj_method} and compute an empirical z-score:
\deqn{z = \frac{X_{obs} - \mu_{null}}{\sigma_{null} + 10^{-9}}}
\item If \code{export = TRUE}, write:
\itemize{
\item \code{prioritized_genes_perm_all.csv} (all tested genes)
\item \verb{prioritized_genes_perm_FDR_<alpha>.csv} (significant genes only)
}
}
}
\note{
This implements a random-labeling null in which DE labels are exchangeable across vertices
in the induced subgraph. If DE status is strongly associated with degree or other network
properties, consider degree-matched or stratified permutation schemes.
}
\examples{
\dontrun{
sig <- prioritize_de(
  genes_oi = rownames(expr),
  de_genes = de_genes,
  net = net,
  B = 100,
  alpha = 0.05
)
head(sig, 20)
}
}
\seealso{
\code{\link[igraph:graph_from_data_frame]{igraph::graph_from_data_frame()}}, \code{\link[igraph:ego]{igraph::ego()}}, \code{\link[stats:p.adjust]{stats::p.adjust()}}
}
